<apex:page standardController="zkmulti__MCShipment__c" extensions="zkmulti.RemoteHandler" lightningStylesheets="true" standardStylesheets="false" sidebar="false" applyBodyTag="false" docType="html-5.0">

<html xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Import the Design System style sheet -->
  <apex:slds />
  	<apex:includeScript value="/support/console/46.0/integration.js"/>

	<apex:variable var="prod" value="{!URLFOR($Resource[zkApp])}" />
	<apex:variable var="prodVendor" value="{!URLFOR($Resource[zkAppVendor])}" />


	<apex:variable var="dev" value="https://localhost:3001" />
	<apex:variable var="hostApp" value="{!IF(isDevMod, dev, prod)}" />
	<apex:variable var="hostVendor" value="{!IF(isDevMod, dev, prodVendor)}" />

	<apex:stylesheet value="{!hostVendor + '/vendor.bundle.css'}"/>
	<apex:stylesheet value="{!hostApp + '/main.bundle.css'}"/>
	<apex:includeScript value="{!hostVendor + '/vendor.bundle.js'}" />
	<apex:includeScript value="{!hostApp + '/main.bundle.js'}" />

</head>
<body>
	<script>

		Sfdc.onReady(function() {
			console.log('Sfdc.onReady');
			if (window.sforce && window.sforce.console && sforce.console.isInConsole()) {
				function initConsoleTab(inTime) {
					if (!window.consoleMainTabId || !window.primaryTabId) {
						setTimeout(() => {
							sforce.console.getFocusedSubtabId((resultFocusedSubtabId) => {
								window.consoleMainTabId = resultFocusedSubtabId.id;
								console.log('consoleMainTabId', window.consoleMainTabId, resultFocusedSubtabId);
								if (!window.consoleMainTabId) {
									initConsoleTab(500);
								} else {
									sforce.console.getEnclosingPrimaryTabId((result) => {
						            	window.primaryTabId = result.id;
						            	console.log('primaryTabId', window.primaryTabId, result);
						            	if (!window.primaryTabId) {
											initConsoleTab(500);
						            	}
						            });
								}
							});
							
						}, inTime);
					}
				}

				sforce.console.setTabTitle('New Shipment');
				initConsoleTab(100);
			};
		});

		(function() {
			'strict mode';

			angular
				.module('app')
				.constant('config', {
					hostMain: "{!hostApp}",
					isLightingCommunityStyle: {!IsLightingCommunityStyle},
					host: "{!hostVendor}",
					isDevMode: "{!isDevMod}",
					UrlPathPrefix: "{!$Site.Prefix}",
					shipment: '{!JSENCODE(sobjectJSON)}',
					api: {
						Session_ID: '{!$Api.Session_ID}'
					},
					pages: {
						CommercialInvoice: '{!URLFOR($Action.zkmulti__CommercialInvoice__c.New)}',
						ProFormaInvoice: '{!URLFOR($Action.zkmulti__ProFormaInvoice__c.New)}',
					},
					user: {
						id: '{!JSENCODE($User.Id)}',
						email: '{!JSENCODE($User.Email)}',
						firstname: '{!JSENCODE($User.FirstName)}',
						lastname: '{!JSENCODE($User.LastName)}'
					},
				})
				.constant('setting', {
				});
		})();
	</script>
  <!-- REQUIRED SLDS WRAPPER -->
  <div class="slds-scope">
	<div ng-app="app" class="zkapplication" ng-strict-di="true" ng-cloak="true">
		<app>
			<multi-wizard></multi-wizard>
		</app>
	</div>
  </div>
  <!-- / REQUIRED SLDS WRAPPER -->

</body>
</html>
</apex:page>