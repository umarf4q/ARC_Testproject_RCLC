ÿÿo"key"¡00D6C0000000xA60DB0V000001UJIr005d0000006Vbbuen_USb9722003-04fc-4b83-8618-77461a2deb51BLM16236814200000000000038253.0:markup://embeddedService:liveAgentStateChat"itemo"value"‰¥{"xs":"I","descriptor":"markup://embeddedService:liveAgentStateChat","st":{"descriptor":"css://embeddedService.liveAgentStateChat","co":".embeddedServiceLiveAgentStateChat{display:flex;flex-direction:column}.embeddedServiceLiveAgentStateChat .messageArea{width:100%;max-height:100%;overflow-y:auto;margin:0;box-sizing:border-box;background-color:var(--lwc-esColorBackgroundInverse,#fff);flex-grow:1;display:flex;flex-direction:column;align-self:stretch;-webkit-overflow-scrolling:touch}.embeddedServiceLiveAgentStateChat .messageArea.smoothScroll{scroll-behavior:auto}@media not screen and (prefers-reduced-motion:no-preference),only screen and (prefers-reduced-motion:reduce){.embeddedServiceLiveAgentStateChat .messageArea,.embeddedServiceLiveAgentStateChat .messageArea.smoothScroll{scroll-behavior:auto}}.embeddedServiceLiveAgentStateChat .messageArea:focus{border:1px solid var(--lwc-colorBrand,rgb(237, 27, 46));outline:none}.embeddedServiceLiveAgentStateChat .chatSessionStartTime{color:var(--lwc-colorTextDefault,rgb(51, 51, 51));font-weight:var(--lwc-fontWeightRegular,400);line-height:1.3;font-size:var(--lwc-esFontSizeTextXSmall,0.75em);margin:8px 0 12px;flex:1 1 auto;display:flex;align-content:center;flex-direction:column-reverse;min-height:1em}.embeddedServiceLiveAgentStateChat .messageWrapper{padding:0;margin:0;list-style:none;-webkit-overflow-scrolling:touch}.embeddedServiceLiveAgentStateChat .messageWrapper,.embeddedServiceLiveAgentStateChat .typingIndicatorContainer,.embeddedServiceLiveAgentStateChat .queuePositionContainer{flex:0 0 auto}.embeddedServiceLiveAgentStateChat .transferringText{font-size:.875em;margin-top:12px;margin-bottom:12px;display:inline-block;padding:0 18px}.embeddedServiceLiveAgentStateChat .messageWrapper:before,.embeddedServiceLiveAgentStateChat .messageWrapper:after{content:\" \";display:table}.embeddedServiceLiveAgentStateChat .floatedHeader{width:100%;position:absolute;z-index:1}.embeddedServiceLiveAgentStateChat .endChatContainer{position:relative;width:100%;display:flex;flex-direction:column;box-sizing:border-box;padding:0 0 24px;flex-shrink:0}.embeddedServiceLiveAgentStateChat .endChatContainer:before{position:absolute;content:\" \";width:100%;height:24px;background:linear-gradient(to bottom, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.5) 100%);left:0;top:-24px}.embeddedServiceLiveAgentStateChat .endChatContainer .endChatButton{width:calc(100% - 48px);height:44px;line-height:19px;margin:0 24px}.embeddedServiceLiveAgentStateChat .endChatContainer .endChatButton.postChatButton.saveTranscriptButton{margin-top:10px;border:1px solid var(--lwc-colorBrand,rgb(237, 27, 46))}.embeddedServiceLiveAgentStateChat .endChatContainer .endChatButton.postChatButton.saveTranscriptButton span,.embeddedServiceLiveAgentStateChat .endChatContainer .endChatButton.postChatButton.saveTranscriptButton:hover span{color:var(--lwc-colorTextDefault,rgb(51, 51, 51))}.embeddedServiceLiveAgentStateChat .chasitorInputWrapper{border-radius:0}","cl":"embeddedServiceLiveAgentStateChat"},"su":"markup://embeddedService:sidebarState","ad":[["body","aura://Aura.Component[]","G",false,[]],["name","aura://String","I",true],["extendedHeader","aura://Aura.Component[]","I",false,[]],["chasitor","aura://Object","I",false,null],["footerMenuOptions","aura://Object[]","I",false,[]],["chatMessages","aura://Aura.Component[]","I",false,[]],["chatSessionStartTime","aura://String","I",false],["endChatAssistiveText","aura://String","I",false],["agentName","aura://String","I",false],["avatarImgURL","aura://String","I",false],["chatBotHasBeenInChat","aura://Boolean","I",false,false],["isChattingWithAgent","aura://Boolean","I",false,true],["isChatConference","aura://Boolean","I",false,false],["agentsInChat","aura://String[]","I",false,[]],["agentAvatarMap","aura://Map","I",false,null],["hasChatEnded","aura://Boolean","I",false,false],["chatEndedReason","aura://String","I",false,""],["postChatURL","aura://String","I",false],["postChatData","aura://Object","I",false,null],["surveyDevName","aura://String","I",false],["unseenMessageCount","aura://Integer","I",false,0],["isUnseenMessageBannerDisplayed","aura://Boolean","I",false],["chatWindowResizeClass","aura://String","I",false,"dynamicResizeTextOneRow"],["browserFlashIntervalIds","aura://Integer[]","I",false,[]],["clearNotificationEventHandler","aura://Object","I",false,null],["messageAreaScrollHandler","aura://Object","I",false,null],["scrollDebounceTimeout","aura://Object","I",false,null],["scrollToBottomOnNextRerender","aura://Boolean","I",false,false],["isAgentTyping","aura://Boolean","I",false,false],["isReconnecting","aura://Boolean","I",false,false],["showTransferText","aura://Boolean","I",false,false],["showReconnectSuccess","aura://Boolean","I",false,false],["isTransferring","aura://Boolean","I",false,false],["showTransferSuccess","aura://Boolean","I",false,false],["timeoutSecondsRemaining","aura://Integer","I",false,-1],["themeLayoutTypeForCommunities","aura://String","I",false],["isQueuePositionEnabled","aura://Boolean","I",false,false],["queuePosition","aura://Integer","I",false],["transferRequestTime","aura://Integer","I",false,-1],["isSaveTranscriptEnabled","aura://Boolean","I",false,false],["plaintextMessageComponentName","aura://String","I",false,""],["endChatCallback","aura://Object","I",false,null],["scrollEnabled","aura://Boolean","I",false,false],["scrolledUp","aura://Boolean","I",false,false],["chatConferenceHeaderAnnouncementSubText","aura://String","I",false,""]],"med":[{"name":"embeddedService:register","xs":"I","attributes":[["sidebarConfiguration","aura://Object","I",false,null],["callback","apex://Function","I",false,null]]},{"name":"embeddedService:getFeature","xs":"I"},{"name":"embeddedService:destroyState","xs":"I"}],"hd":[{"x":{"exprType":"PROPERTY","byValue":false,"path":"c.onChatWindowResizeClassChanged"},"v":{"exprType":"PROPERTY","byValue":false,"path":"v.chatWindowResizeClass"},"n":"change"},{"ed":{"descriptor":"markup://siteforce:changeView"},"x":{"exprType":"PROPERTY","byValue":false,"path":"c.onChangeViewForCommunities"}},{"ed":{"descriptor":"markup://embeddedService:liveAgentSendRichMessage"},"x":{"exprType":"PROPERTY","byValue":false,"path":"c.sendRichMessage"},"n":"sendRichMessage"},{"ed":{"descriptor":"markup://embeddedService:liveAgentClickUnseenMessageNotification"},"x":{"exprType":"PROPERTY","byValue":false,"path":"c.onUnseenMessageNotificationClick"},"n":"clickUnseenMessageNotification"}],"ld":{"inputFooter":{}},"fa":[{"descriptor":"name","value":"Chat"},{"descriptor":"body","value":[{"componentDef":{"descriptor":"markup://embeddedService:sidebarScriptLoader"},"localId":"sidebarScriptLoader"},{"componentDef":{"descriptor":"markup://aura:html"},"localId":"messageArea","attributes":{"values":{"HTMLAttributes":{"descriptor":"HTMLAttributes","value":{"class":"messageArea smoothScroll","tabindex":"0","onscroll":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"c.handleScroll"}}},"tag":{"descriptor":"tag","value":"div"},"body":{"descriptor":"body","value":[{"componentDef":{"descriptor":"markup://aura:html"},"attributes":{"values":{"HTMLAttributes":{"descriptor":"HTMLAttributes","value":{"class":"chatSessionStartTime"}},"tag":{"descriptor":"tag","value":"div"},"body":{"descriptor":"body","value":[{"componentDef":{"descriptor":"markup://aura:html"},"attributes":{"values":{"HTMLAttributes":{"descriptor":"HTMLAttributes","value":{"id":"chatWindowCurrentDesc"}},"tag":{"descriptor":"tag","value":"span"},"body":{"descriptor":"body","value":[{"componentDef":{"descriptor":"markup://aura:expression"},"attributes":{"values":{"value":{"descriptor":"value","value":{"exprType":"FUNCTION","code":"function(cmp,fn){return fn.format($A.get(\"$ESWLabel.LiveAgentChatWindow.ChatStartTime\"),cmp.get(\"v.chatSessionStartTime\"));}","args":[{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"$ESWLabel.LiveAgentChatWindow.ChatStartTime"},{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"v.chatSessionStartTime"}],"byValue":false}}}}}]}}}}]}}}},{"componentDef":{"descriptor":"markup://aura:html"},"attributes":{"values":{"HTMLAttributes":{"descriptor":"HTMLAttributes","value":{"class":"messageWrapper"}},"tag":{"descriptor":"tag","value":"ul"},"body":{"descriptor":"body","value":[{"componentDef":{"descriptor":"markup://aura:expression"},"attributes":{"values":{"value":{"descriptor":"value","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"v.chatMessages"}}}}}]}}}},{"componentDef":{"descriptor":"markup://aura:html"},"attributes":{"values":{"HTMLAttributes":{"descriptor":"HTMLAttributes","value":{"class":"typingIndicatorContainer","aria-relevant":"additions text","aria-live":"polite","aria-atomic":"false"}},"tag":{"descriptor":"tag","value":"div"},"body":{"descriptor":"body","value":[{"componentDef":{"descriptor":"markup://aura:if"},"attributes":{"values":{"isTrue":{"descriptor":"isTrue","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"v.isAgentTyping"}},"body":{"descriptor":"body","value":[{"componentDef":{"descriptor":"markup://embeddedService:liveAgentStateChatTypingIndicator"},"localId":"typingIndicator","attributes":{"values":{"avatarImgURL":{"descriptor":"avatarImgURL","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"v.avatarImgURL"}}}}},{"componentDef":{"descriptor":"markup://aura:html"},"attributes":{"values":{"HTMLAttributes":{"descriptor":"HTMLAttributes","value":{"class":"assistiveText"}},"tag":{"descriptor":"tag","value":"span"},"body":{"descriptor":"body","value":[{"componentDef":{"descriptor":"markup://aura:expression"},"attributes":{"values":{"value":{"descriptor":"value","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"$ESWLabel.LiveAgentChatWindow.AgentTypingUpdate"}}}}}]}}}}]}}}}]}}}},{"componentDef":{"descriptor":"markup://aura:html"},"attributes":{"values":{"HTMLAttributes":{"descriptor":"HTMLAttributes","value":{"class":"queuePositionContainer"}},"tag":{"descriptor":"tag","value":"div"},"body":{"descriptor":"body","value":[{"componentDef":{"descriptor":"markup://aura:if"},"attributes":{"values":{"isTrue":{"descriptor":"isTrue","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"v.isTransferring"}},"body":{"descriptor":"body","value":[{"componentDef":{"descriptor":"markup://embeddedService:liveAgentQueuePosition"},"localId":"queuePosition","attributes":{"values":{"isTransferring":{"descriptor":"isTransferring","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"v.isTransferring"}}}}},{"componentDef":{"descriptor":"markup://aura:if"},"attributes":{"values":{"isTrue":{"descriptor":"isTrue","value":{"exprType":"FUNCTION","code":"function(cmp,fn){return (cmp.get(\"v.showTransferText\")||!(cmp.get(\"v.isQueuePositionEnabled\")));}","args":[{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"v.showTransferText"},{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"v.isQueuePositionEnabled"}],"byValue":false}},"body":{"descriptor":"body","value":[{"componentDef":{"descriptor":"markup://aura:html"},"attributes":{"values":{"HTMLAttributes":{"descriptor":"HTMLAttributes","value":{"class":"transferringText"}},"tag":{"descriptor":"tag","value":"span"},"body":{"descriptor":"body","value":[{"componentDef":{"descriptor":"markup://aura:expression"},"attributes":{"values":{"value":{"descriptor":"value","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"$ESWLabel.LiveAgentTransfer.BannerInProgressTransfer"}}}}}]}}}}]}}}}]}}}}]}}}}]}}}},{"componentDef":{"descriptor":"markup://aura:if"},"attributes":{"values":{"isTrue":{"descriptor":"isTrue","value":{"exprType":"FUNCTION","code":"function(cmp,fn){return !(cmp.get(\"v.hasChatEnded\"));}","args":[{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"v.hasChatEnded"}],"byValue":false}},"else":{"descriptor":"else","value":[{"componentDef":{"descriptor":"markup://aura:html"},"attributes":{"values":{"HTMLAttributes":{"descriptor":"HTMLAttributes","value":{"class":"endChatContainer","role":"alert"}},"tag":{"descriptor":"tag","value":"div"},"body":{"descriptor":"body","value":[{"componentDef":{"descriptor":"markup://aura:if"},"attributes":{"values":{"isTrue":{"descriptor":"isTrue","value":{"exprType":"FUNCTION","code":"function(cmp,fn){return (!(cmp.get(\"v.isSaveTranscriptEnabled\"))||!((!(fn.empty(cmp.get(\"v.postChatURL\")))||!(fn.empty(cmp.get(\"v.surveyDevName\"))))));}","args":[{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"v.postChatURL"},{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"v.surveyDevName"},{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"v.isSaveTranscriptEnabled"}],"byValue":false}},"body":{"descriptor":"body","value":[{"componentDef":{"descriptor":"markup://embeddedService:sidebarButton"},"localId":"endChatButton","attributes":{"values":{"class":{"descriptor":"class","value":"endChatButton closeChatButton"},"press":{"descriptor":"press","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"c.onCloseChatPressed"}},"label":{"descriptor":"label","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"$ESWLabel.LiveAgentChatWindow.ChatButtonClose"}}}}}]}}}},{"componentDef":{"descriptor":"markup://aura:if"},"attributes":{"values":{"isTrue":{"descriptor":"isTrue","value":{"exprType":"FUNCTION","code":"function(cmp,fn){return (!(fn.empty(cmp.get(\"v.postChatURL\")))||!(fn.empty(cmp.get(\"v.surveyDevName\"))));}","args":[{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"v.postChatURL"},{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"v.surveyDevName"}],"byValue":false}},"body":{"descriptor":"body","value":[{"componentDef":{"descriptor":"markup://embeddedService:sidebarButton"},"localId":"postChatButton","flavor":{"exprType":"FUNCTION","code":"function(cmp,fn){return (cmp.get(\"v.isSaveTranscriptEnabled\")?\"default\":\"inverse\");}","args":[{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"v.isSaveTranscriptEnabled"}],"byValue":false},"attributes":{"values":{"class":{"descriptor":"class","value":"endChatButton postChatButton"},"press":{"descriptor":"press","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"c.onPostChatPressed"}},"label":{"descriptor":"label","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"$ESWLabel.LiveAgentChatWindow.PostChatButton"}}}}}]}}}},{"componentDef":{"descriptor":"markup://aura:if"},"attributes":{"values":{"isTrue":{"descriptor":"isTrue","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"v.isSaveTranscriptEnabled"}},"body":{"descriptor":"body","value":[{"componentDef":{"descriptor":"markup://embeddedService:sidebarButton"},"localId":"saveTranscriptButton","flavor":"inverse","attributes":{"values":{"class":{"descriptor":"class","value":"endChatButton saveTranscriptButton"},"press":{"descriptor":"press","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"c.onSaveChatPressed"}},"label":{"descriptor":"label","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"$ESWLabel.LiveAgentChatWindow.SaveTranscript"}}}}}]}}}}]}}}}]},"body":{"descriptor":"body","value":[{"componentDef":{"descriptor":"markup://embeddedService:liveAgentStateChatInputFooter"},"localId":"inputFooter","attributes":{"values":{"onFileUploadComplete":{"descriptor":"onFileUploadComplete","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"c.onFileUploadComplete"}},"sendFileTransferEventLine":{"descriptor":"sendFileTransferEventLine","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"c.createFileTransferEventLine"}},"chatWindowResizeClass":{"descriptor":"chatWindowResizeClass","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"v.chatWindowResizeClass"}},"onTyping":{"descriptor":"onTyping","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"c.handleSneakPeek"}},"isReconnecting":{"descriptor":"isReconnecting","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"v.isReconnecting"}},"footerMenuOptions":{"descriptor":"footerMenuOptions","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"v.footerMenuOptions"}},"unseenMessageCount":{"descriptor":"unseenMessageCount","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"v.unseenMessageCount"}},"isAgentTyping":{"descriptor":"isAgentTyping","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"v.isAgentTyping"}},"isTransferring":{"descriptor":"isTransferring","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"v.isTransferring"}},"sendMessage":{"descriptor":"sendMessage","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"c.sendChat"}},"isUnreadMessageBannerDisplayed":{"descriptor":"isUnreadMessageBannerDisplayed","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"v.isUnseenMessageBannerDisplayed"}},"sendFileTransferMessage":{"descriptor":"sendFileTransferMessage","value":{"exprType":"PROPERTY","byValue":false,"target":"embeddedService:liveAgentStateChat","path":"c.createFileTransferMessage"}}}}}]}}}}]}],"cc":"$A.componentService.addComponentClass(\"markup://embeddedService:liveAgentStateChat\",function(){return{meta:{name:\"embeddedService$liveAgentStateChat\",\"extends\":\"markup://embeddedService:sidebarState\",imports:{chatFormatter:\"markup://embeddedService:liveAgentChatFormatter\",chasitorLibrary:\"markup://embeddedService:liveAgentChasitorSessionLibrary\",liveAgentLibrary:\"markup://lightningsnapin:liveAgentLibrary\"}},controller:{sendChat:function(a,b,c){c.handleSend(a,b.message)},sendRichMessage:function(a,\nb,c){c.sendRichMessage(a,{actions:[b.getParams().richMessagePayload]})},handleSneakPeek:function(a,b,c){c.handleSneakPeek(a,b.message)},onCloseChatPressed:function(a,b,c){c.endChatAndDestroy(a)},onPostChatPressed:function(a,b,c){c.switchToPostchat(a)},onSaveChatPressed:function(a,b,c){c.getChasitor(a).saveChat()},onChatWindowResizeClassChanged:function(a){var b=a.getElement().querySelector(\".messageArea\");b&&(a=b.scrollHeight-b.offsetHeight-Math.round(b.scrollTop),0===a&&window.requestAnimationFrame(function(){b.scrollTop=\nb.scrollHeight}))},createFileTransferMessage:function(a,b,c){c.handleSendFileTransferMessage(a,b)},createFileTransferEventLine:function(a,b,c){c.handleCreateFileTransferEventLine(a,b)},onFileUploadComplete:function(a,b,c){c.handleFileUploadComplete(a,b)},onUnseenMessageNotificationClick:function(a,b,c){var d=a.getElement();c.scrollToBottomOfMessageArea(a,!0);0<a.get(\"v.unseenMessageCount\")&&c.clearNewMessageNotifications(a);d.querySelector(\"textarea.chasitorText\").disabled?embedded_svc.util.focusAfterRender(a,\n\".messageArea\"):c.setFocusOnChatInput(a);b.stopPropagation()},onChangeViewForCommunities:function(a,b,c){b=b.getParams().themeLayoutType;c.onChangeViewForCommunities(a,b)},handleScroll:function(a,b,c){c.handleScroll(a)}},helper:{constants:{TAB_TITLE_BLINK_FREQUENCY_MS:1E3,TIMESTAMP_DELAY_MS:6E4,TRANSFER_SUCCESS_BANNER_DURATION_MS:5E3,SALESFORCE_USER_PREFIX:\"005\",ANNOUNCEMENT_TIME_DELAY_AFTER_FOCUS_MS:2E3,DEFAULT_PLAINTEXT_CHAT_MESSAGE_UI_COMPONENT:\"embeddedService:liveAgentStateChatPlaintextMessageDefaultUI\"},\nchatMessageComponents:{undefined:\"embeddedService:liveAgentStateChatMessage\",ChatWindowButton:\"embeddedService:liveAgentStateChatButtonMessage\",ChatWindowMenu:\"embeddedService:liveAgentStateChatMenuMessage\"},systemMessageTypes:\"ended transferred fileTransferCanceled fileTransferSuccess fileTransferFailure fileTransferRequested agentJoinedConference agentLeftConference\".split(\" \"),onPush:function(a,b,c){var d=this.getSidebar(a),e=c.header,f=e.getElement().shadowRoot.querySelector(\".minimizeButton\"),\nh=e.getElement().shadowRoot.querySelector(\".closeButton\");a.set(\"v.isQueuePositionEnabled\",JSON.parse(this.getSidebar(a).getSessionManager().get(\"LA_ESW_SHOW_QUEUE_POSITION\")||\"false\"));a.set(\"v.scrollEnabled\",d.getSessionManager().get(\"SCROLL_ENABLED\")||!1);a.set(\"v.isUnseenMessageBannerDisplayed\",Boolean(d.getSessionManager().get(\"LA_ESW_UNSEEN_MESSAGES\")));b.userId&&this.setAvatarUrl(a,b.userId);this.resetChatState(a);this.updateHeaderAndMinimizedState(a);this.chasitorLibrary.configure(a,this.initializeChatState.bind(this,\na,b,c));e&&(\"embeddedServiceChatHeader\"===e.getName()&&document.activeElement!==f&&document.activeElement!==h)&&this.setFocusOnChatInput(a,function(){setTimeout($A.getCallback(function(){a.isValid()&&embedded_svc.util.getAriaLiveAnnouncer(a).announceMessage(this.determineHeaderSubText(a))}.bind(this)),this.constants.ANNOUNCEMENT_TIME_DELAY_AFTER_FOCUS_MS)}.bind(this));$A.get(\"$Site\")&&a.set(\"v.themeLayoutTypeForCommunities\",$A.getRoot().get(\"v.themeLayoutType\"));this.initializePlaintextChatMessageComponentName(a,\nd)},initializePlaintextChatMessageComponentName:function(a,b){var c=b.getConfigurationValueFromList(\"embeddedServiceConfig.embeddedServiceCustomComponents\",{customComponentType:\"LA_PlainTextChatMessage\"}),d=this.constants.DEFAULT_PLAINTEXT_CHAT_MESSAGE_UI_COMPONENT;c&&(d=c.namespacePrefix+\":\"+c.customComponent);a.set(\"v.plaintextMessageComponentName\",d)},onReveal:function(a,b){this.updateHeaderAndMinimizedState(a);this.setFocusOnChatInput(a);this.onMaximize(a)},onClose:function(a,b){var c=this.getSidebar(a);\na.get(\"v.hasChatEnded\")||(b.stopPropagation(),this.showEndChatDialog(a,c))},showEndChatDialog:function(a,b){b.showDialog({title:$A.get(\"$ESWLabel.MessageOverlay.ChatStateHeader\"),body:$A.get(\"$ESWLabel.MessageOverlay.ChatStateBody\"),buttons:[{label:$A.get(\"$ESWLabel.MessageOverlay.ChatStateEnd\"),callback:this.onEndChatConfirmed.bind(this,a)},{label:$A.get(\"$ESWLabel.MessageOverlay.ChatStateResume\"),flavor:\"inverse\"}],temporaryHeading:$A.get(\"$ESWLabel.LiveAgentSidebarApp.LiveChat\"),onClose:function(){this.endChatAndDestroy(a)}.bind(this),\nonRender:$A.getCallback(a.get(\"v.endChatCallback\"))})},onDestroy:function(a){var b=this.getChasitor(a),c;b&&(c=b.chasitorData.chatKey,b.onDestroy(),this.isLastActiveStateForFeature(a)&&embedded_svc.util.transaction(\"performance:EndChat\",{chatId:c}))},endChatAndDestroy:function(a){var b=this.getChasitor(a);b&&b.chasitorData.isChatEngaged&&b.endChat();this.destroySidebar(a)},destroySidebar:function(a){if(a=this.getSidebar(a))a.getSessionManager().remove(\"CHASITOR_SERIALIZED_KEY\",\"MASTER_DEPLOYMENT_ID\"),\na.destroy()},initializeChatState:function(a,b,c){var d=this.getSidebar(a);b.fromWaitingState?(this.afterChasitorLoaded(a),this.setHeaderAnnouncementSubText(a,$A.get(\"$ESWLabel.LiveAgentChatWindow.ChatStateHeaderGreeting\")),embedded_svc.util.getAriaLiveAnnouncer(a).announceMessage(this.determineHeaderSubText(a),{context:d.helper.constants.eventNames.CHAT_STATE})):a.get(\"v.chasitor\").loadChasitorAndStartChatSession({latestChasitorVersion:d.getData(\"latestChasitorVersion\"),sidebarScriptLoader:a.find(\"sidebarScriptLoader\"),\nsidebarData:c.configurationData,stateData:b,isQueuePositionEnabled:a.get(\"v.isQueuePositionEnabled\"),restoreChatSessionCallback:this.afterChatSessionRestored.bind(this,a),startChatAPI:b.chatAPISettings});d.setIsLoading(!1)},afterChasitorLoaded:function(a){var b=this.getChasitor(a),c=this.getSidebar(a),d=c.getConfigurationValue(\"externalScripts\"),e=c.getConfigurationValue(\"externalStyles\"),f=b.chasitorData.details.agent.agentName,h=b.chasitorData.details.agent.userId,g=b.chasitorData.details.agent.transfer;\nf&&(h&&1>g)&&(a.set(\"v.agentName\",f),a.set(\"v.agentsInChat\",[f]),this.setAvatarUrl(a,h),this.updateAgentAvatarMap(a,h,f),this.setHeaderText(a,f),this.updateHeaderAndMinimizedState(a));this.registerEvents(a);this.initializeChatSessionStartTime(a);this.setChatInputFooterMenuOptions(a,b.chasitorData);b.updateChatWindowState(a.get(\"v.name\"));a.find(\"inputFooter\").onChasitorInitialized(b);2.2<c.getReleaseVersion()&&embedded_svc.util.broadcastEventToClientAndLog(\"onChatStateLoaded\",{liveAgentSessionKey:b.chasitorData.chatKey,\nisTabPrimary:embedded_svc.liveAgentAPI.browserSessionInfo?embedded_svc.liveAgentAPI.browserSessionInfo.isMaster||embedded_svc.liveAgentAPI.browserSessionInfo.isPrimary:void 0,activeTabsInChat:embedded_svc.liveAgentAPI.browserSessionInfo?embedded_svc.liveAgentAPI.browserSessionInfo.activeChatSessions:void 0},c.getReleaseVersion());if(!$A.util.isUndefined(d)||!$A.util.isUndefined(e))d=d?embedded_svc.util.getResourcesArray(d):[],e=e?embedded_svc.util.getResourcesArray(e):[],a.find(\"sidebarScriptLoader\").request({scripts:d,\nstyles:e,callback:this.onCustomEventsScriptsLoaded.bind(this,a)})},setChatInputFooterMenuOptions:function(a,b){var c=b.hasOwnProperty(\"transcriptSaveEnabled\"),d=(b.hasOwnProperty(\"isSnapinsSlaveTab\")||b.hasOwnProperty(\"isSnapinsSecondaryTab\"))&&this.isMobileDevice(),e=this.getSidebar(a),e=e.getSessionManager().get(\"CHATBOT_FOOTER_MENU\")?JSON.parse(e.getSessionManager().get(\"CHATBOT_FOOTER_MENU\")):[],f=[];if((!c||b.transcriptSaveEnabled)&&!d)a.set(\"v.isSaveTranscriptEnabled\",!0),f.push({text:$A.get(\"$ESWLabel.LiveAgentChatWindow.SaveTranscript\"),\nvalue:$A.get(\"$ESWLabel.LiveAgentChatWindow.SaveTranscript\"),id:\"@saveTranscript\",callback:function(){a.helper.getChasitor(a).saveChat()}});e instanceof Array&&Boolean(e.length)&&e.forEach(function(a){f.push(a)});a.set(\"v.footerMenuOptions\",f)},onCustomEventsScriptsLoaded:function(a){var b=this.getSidebar(a);a=this.getChasitor(a).chasitorData;2.2<b.getReleaseVersion()&&embedded_svc.util.broadcastEventToClientAndLog(\"onCustomEventsScriptsLoaded\",{liveAgentSessionKey:a.chatKey,isTabPrimary:embedded_svc.liveAgentAPI.browserSessionInfo?\nembedded_svc.liveAgentAPI.browserSessionInfo.isMaster||embedded_svc.liveAgentAPI.browserSessionInfo.isPrimary:void 0,activeTabsInChat:embedded_svc.liveAgentAPI.browserSessionInfo?embedded_svc.liveAgentAPI.browserSessionInfo.activeChatSessions:void 0},b.getReleaseVersion())},getChasitor:function(a){return a.get(\"v.chasitor\")},registerEvents:function(a){var b=this.getChasitor(a),c=this.getSidebar(a).getReleaseVersion();b.clearEventHandlers();b.registerEvent(a,b.events.CHAT_REQUEST_FAILED,this.onChatRequestFailed);\nb.registerEvent(a,b.events.CHASITOR_CHAT_MESSAGE,this.onChasitorMessage);b.registerEvent(a,b.events.AGENT_CHAT_MESSAGE,this.onAgentMessage);b.events.AGENT_RICH_MESSAGE&&b.registerEvent(a,b.events.AGENT_RICH_MESSAGE,this.onAgentRichMessage);b.registerEvent(a,b.events.AGENT_DISCONNECTED,this.onReconnecting);b.registerEvent(a,b.events.AGENT_TYPING_UPDATE,this.onAgentTyping);b.registerEvent(a,b.events.AGENT_CHAT_ENDED,this.onChatEndedByAgent);b.registerEvent(a,b.events.CHASITOR_CHAT_ENDED,this.onChatEndedByChasitor);\nb.registerEvent(a,b.events.CHATBOT_ENDED_CHAT,this.onChatEndedByChatbot);b.registerEvent(a,b.events.POST_CHAT,this.onChatEndedWithPostChat);b.registerEvent(a,b.events.AGENT_CHAT_TRANSFER_TO_BUTTON_INITIATED,this.onChatTransferToButtonInitiated);b.registerEvent(a,b.events.AGENT_CHAT_TRANSFER_TO_QUEUE_INITIATED,this.onChatTransferToQueueOrSkills);b.registerEvent(a,b.events.AGENT_CHAT_TRANSFER_TO_SBR_SKILL_INITIATED,this.onChatTransferToQueueOrSkills);b.registerEvent(a,b.events.AGENT_CHAT_TRANSFERRED,\nthis.onChatTransferSuccessful);b.registerEvent(a,b.events.BOT_CHAT_TRANSFERRED,this.onChatTransferSuccessful);b.registerEvent(a,b.events.QUEUE_UPDATE,this.onQueueUpdate);b.registerEvent(a,b.events.AGENT_JOINED_CONFERENCE,this.onAgentJoinedConference);b.registerEvent(a,b.events.AGENT_LEFT_CONFERENCE,this.onAgentLeftConference);b.registerEvent(a,b.events.CHAT_ESTABLISHED,this.onChatEstablished);b.registerEvent(a,b.events.RECONNECTING,this.onReconnecting);b.registerEvent(a,b.events.CHAT_REQUEST_SUCCESSFUL,\nthis.onReconnectingAfterChatEnded);b.registerEvent(a,b.events.CONNECTION_ERROR,this.onConnectionError);b.registerEvent(a,b.events.START_CHASITOR_IDLE_TIMEOUT_WARNING,this.onIdleTimeoutWarningStart);b.registerEvent(a,b.events.UPDATE_CHASITOR_IDLE_TIMEOUT_WARNING,this.onIdleTimeoutWarningUpdate);b.registerEvent(a,b.events.CLEAR_CHASITOR_IDLE_TIMEOUT,this.onIdleTimeoutClear);b.registerEvent(a,b.events.CHASITOR_IDLE_TIMEOUT,this.onIdleTimeoutOccurred);3<=Number(c)&&(embedded_svc.addEventHandler(\"liveagent.chatCanceledOnDifferentTab\",\nthis.onChatEndedOnDifferentTab.bind(this,a)),embedded_svc.addEventHandler(\"snapinsCloseSessionWarning\",this.onCloseSessionWarning.bind(this,a)))},afterChatSessionRestored:function(a){var b=this.getSidebar(a),c=this.getChasitor(a),b=b.getSessionManager(),d,e;a.isValid()&&(this.afterChasitorLoaded(a),d=c.chasitorData.chatMessages,this.restoreMessages(a,d,c),e=this.getMessageAreaElement(a),a.set(\"v.unseenMessageCount\",Number(b.get(\"LA_ESW_UNSEEN_MESSAGES\")||0)),e.classList.remove(\"smoothScroll\"),this.waitForChatMessagesToRender(a,\ne,Number(b.get(\"LA_ESW_CHAT_SCROLL_POSITION\"))),embedded_svc.util.waitForFrame(a,function(){a.set(\"v.isUnseenMessageBannerDisplayed\",this.shouldUnseenMessageCounterBeDisplayed(a));e.classList.add(\"smoothScroll\")}.bind(this)))},restoreMessages:function(a,b,c){var d=c.chasitorData.details.agent,d=d?d.agentName:\"\";b.forEach(function(c,d){var h=!1,g={type:c.getType(),name:c.getName(),content:c.getContent(),userId:c.getUserId(),timestamp:c.getTimestamp(),date:c.getDate(),index:d},k;\"transferred\"===g.type?\na.set(\"v.agentsInChat\",[g.name]):\"agentJoinedConference\"===g.type?this.updateAgentsInChat(a,g.name,!0):\"agentLeftConference\"===g.type&&this.updateAgentsInChat(a,g.name,!1);c.getUserId()&&(this.setAvatarUrl(a,c.getUserId()),g.avatarImgUrl=this.getAvatarUrl(a));d===b.length-1?(h=!0,k=-1):k=\"string\"===typeof b[d+1].getContent()?b[d+1].getDate():-1;this.createChatMessage(a,g,!0,h,k,b[d+1])}.bind(this));a.set(\"v.agentName\",d);a.set(\"v.isTransferring\",c.chasitorData.isChatTransferredToQueue);a.get(\"v.isQueuePositionEnabled\")&&\n(this.onQueueUpdate(a,c.chasitorData.queuePosition),a.set(\"v.transferRequestTime\",(new Date).getTime()));1<a.get(\"v.agentsInChat\").length?(a.set(\"v.isChatConference\",1<a.get(\"v.agentsInChat\").length),this.setHeaderText(a,$A.get(\"$ESWLabel.LiveAgentGroupChat.HeaderTitle\"))):this.setHeaderText(a,d)},waitForChatMessagesToRender:function(a,b,c){embedded_svc.util.waitForFrame(a,function(){b&&(b.scrollTop=c,this.updateHeaderAndMinimizedState(a))}.bind(this))},onConnectionError:function(a){var b=embedded_svc.getSidebar(a),\nc=this.getChasitor(a).chasitorData;a.set(\"v.chatEndedReason\",b.helper.constants.endedReasonNames.chat.VISITOR_CONNECTION_ERROR);this.endChatWithReasonLabel(a,$A.get(\"$ESWLabel.LiveAgentChatWindow.ChatEndConnection\"));embedded_svc.util.broadcastEventToClientAndLog(\"onConnectionError\",{liveAgentSessionKey:c.chatKey},this.getSidebar(a).getReleaseVersion())},onChatRequestFailed:function(a,b){var c=embedded_svc.getSidebar(a);if(\"Unavailable\"===b)a.set(\"v.chatEndedReason\",c.helper.constants.endedReasonNames.chat.AGENTS_UNAVAILABLE),\nthis.endChatWithReasonLabel(a,$A.get(\"$ESWLabel.MessageOverlay.ErrorNoAgentHeader\"));else this.onChatEndedByAgent(a)},onChatEstablished:function(a){if(a.get(\"v.isReconnecting\"))this.onChatReconnectionSuccessful(a)},onChasitorMessage:function(a,b){var c=this.getChasitor(a).chasitorData;a.set(\"v.scrollEnabled\",!0);this.markMostRecentMessageClicked(a);this.createChatMessage(a,{type:\"chasitor\",name:c.name||\"\",content:b.getContent(),userId:b.getUserId()||\"\",timestamp:b.getTimestamp(),date:b.getDate()});\nthis.scrollToBottomOfMessageArea(a,!0);0<a.get(\"v.unseenMessageCount\")&&this.clearNewMessageNotifications(a);embedded_svc.util.broadcastEventToClientAndLog(\"onChasitorMessage\",{liveAgentSessionKey:c.chatKey},this.getSidebar(a).getReleaseVersion())},onAgentMessage:function(a,b){var c=this.getSidebar(a),d=this.getChasitor(a).chasitorData,e={type:b.getType(),name:b.getName()||\"\",content:b.getContent(),userId:b.getUserId()||\"\",timestamp:b.getTimestamp(),date:b.getDate()},f;f=this.getAgentNameFromChatMessage(e,\nd);a.set(\"v.agentName\",f);this.setHeaderText(a,a.get(\"v.agentsInChat\")&&1<a.get(\"v.agentsInChat\").length?$A.get(\"$ESWLabel.LiveAgentGroupChat.HeaderTitle\"):a.get(\"v.agentName\"));this.createChatMessage(a,e);this.onAgentMessageAfter(a,c);a.set(\"v.isTransferring\",!1);embedded_svc.util.transaction(\"performance:MessageSentByAgent\",{chatId:d.chatKey});embedded_svc.util.broadcastEventToClientAndLog(\"onAgentMessage\",{liveAgentSessionKey:d.chatKey},this.getSidebar(a).getReleaseVersion())},onAgentRichMessage:function(a,\nb){var c=this.getSidebar(a),d=this.getChasitor(a).chasitorData,e={};e.content=b;e.date=new Date;this.createRichMessage(a,e);this.onAgentMessageAfter(a,c);embedded_svc.util.transaction(\"performance:MessageSentByChatbot\",{chatId:d.chatKey});embedded_svc.util.broadcastEventToClientAndLog(\"onAgentRichMessage\",{liveAgentSessionKey:d.chatKey},c.getReleaseVersion())},onAgentMessageAfter:function(a,b){a.set(\"v.isAgentTyping\",!1);this.incrementUnseenMessages(a);this.updateHeaderAndMinimizedState(a)},onMinimize:function(a){this.updateHeaderAndMinimizedState(a)},\nonMaximize:function(a){this.updateHeaderAndMinimizedState(a);a.set(\"v.chatConferenceHeaderAnnouncementSubText\",\"\");this.setHeaderAnnouncementSubText(a,\"\");embedded_svc.util.waitForFrame(a,function(){var b=this.getMessageAreaElement(a),c=this.getSidebar(a).getSessionManager().get(\"LA_ESW_CHAT_SCROLL_POSITION\");b&&(b.classList.remove(\"smoothScroll\"),b.scrollTop=Number(c),b.classList.add(\"smoothScroll\"),this.shouldUnseenMessageCounterBeDisplayed(a)||(this.scrollToBottomOfMessageArea(a,!0),this.clearNewMessageNotifications(a)))}.bind(this))},\nupdateTitleNotification:function(a){var b=this.getSidebar(a),c=a.get(\"v.browserFlashIntervalIds\"),d=this.getTitleNotificationMessages(a),e,f;d&&(b=b.getData(\"defaultDocumentTitle\"),e=d[0],f=d[1]?d[1]+\" \"+b:b,this.clearAllFlashIntervals(a),document.title=e,d=window.setInterval(function(){document.title=document.title===e?f:e},this.constants.TAB_TITLE_BLINK_FREQUENCY_MS),c.push(d),a.set(\"v.browserFlashIntervalIds\",d))},getTitleNotificationMessages:function(a){var b=a.get(\"v.unseenMessageCount\");if(a.get(\"v.hasChatEnded\"))this.clearNotifications(a);\nelse{if(-1!==a.get(\"v.timeoutSecondsRemaining\"))return[$A.get(\"$ESWLabel.LiveAgentChatWindow.IdleTimeoutMinimizedWarning\")];if(0<b)return[$A.util.format($A.get(\"$ESWLabel.LiveAgentChatWindow.AgentSaysNotification\"),this.getAgentName(a)),\"(\"+b+\")\"]}},clearNotifications:function(a){this.clearAllFlashIntervals(a);document.title=this.getSidebar(a).getData(\"defaultDocumentTitle\")},incrementUnseenMessages:function(a){var b=a.get(\"v.unseenMessageCount\");if(this.shouldUnseenMessageCounterBeDisplayed(a)||\n\"visible\"!==document.visibilityState)a.set(\"v.unseenMessageCount\",b+1),this.getSidebar(a).getSessionManager().set(\"LA_ESW_UNSEEN_MESSAGES\",b+1)},clearAllFlashIntervals:function(a){for(a=a.get(\"v.browserFlashIntervalIds\");a.length;)clearInterval(a.pop())},resetChatState:function(a){a.set(\"v.hasChatEnded\",!1);a.set(\"v.unseenMessageCount\",0);a.set(\"v.browserFlashIntervalIds\",[]);a.set(\"v.chatMessages\",[]);a.set(\"v.isReconnecting\",!1);a.set(\"v.isAgentTyping\",!1)},markMostRecentMessageClicked:function(a){(a=\n(a=a.get(\"v.chatMessages\"))?a[a.length-1]:void 0)&&a.get(\"v\").hasAttribute(\"isOptionClicked\")&&a.set(\"v.isOptionClicked\",!0)},sendChat:function(a,b){var c=this.getChasitor(a);c.chasitorData.isChatEngaged&&(c.sendMessage(b),embedded_svc.util.transaction(\"performance:MessageSentByVisitor\",{chatId:c.chasitorData.chatKey}))},sendRichMessage:function(a,b){this.getChasitor(a).sendRichMessage(b);this.setFocusOnChatInput(a)},sendRichMessageWrapper:function(a){return function(b){this.sendRichMessage(a,b)}.bind(this)},\ngetMinimizedNotificationMessage:function(a){return 1===a?$A.get(\"$ESWLabel.LiveAgentChatWindow.SingleMessageNotification\"):$A.util.format($A.get(\"$ESWLabel.LiveAgentChatWindow.MessageNotification\"),a)},endChat:function(a){var b=this.getChasitor(a);if(!a.get(\"v.isReconnecting\")&&(b.chasitorData.isChatEngaged||b.chasitorData.isChatTransferredToBot||b.chasitorData.isChatTransferredToQueue||b.chasitorData.isChatTransferredToSbrSkill))b.endChat(),embedded_svc.util.transaction(\"performance:EndChat\",{chatId:b.chasitorData.chatKey});\nembedded_svc.util.focusAfterRender(a,\".closeChatButton\")},onAgentTyping:function(a){var b=this.getChasitor(a).chasitorData.isAgentTyping,c=a.get(\"v.chatMessages\"),d=c.length?c[c.length-1]:void 0,e=a.get(\"v.isChatConference\"),f=a.get(\"v.agentAvatarMap\")||new Map,h,g,k;this.scrollToBottomOfMessageArea(a);a.set(\"v.isAgentTyping\",b);h=a.find(\"typingIndicator\");e||0===a.get(\"v.agentsInChat\").length?h&&this.setMessageData(h,{isAgentAvatarHidden:!0}):(d&&\"agent\"===d.get(\"v.message\").type&&d.setLastInGroup(!b),\ng=a.get(\"v.agentsInChat\")[0],f.forEach(function(a){a.agentName===g&&(k=a)}),k||(k=this.generateAgentAvatarData(a,g,f.size)),h&&this.setMessageData(h,k));a.set(\"v.chatMessages\",c)},onChatEndedByAgent:function(a){var b=embedded_svc.getSidebar(a),c=this.getChasitor(a).chasitorData;this.populateSurveyDevNameIfExists(a);a.set(\"v.chatEndedReason\",b.helper.constants.endedReasonNames.chat.AGENT_ENDED_CHAT);this.endChatWithReasonLabel(a,$A.get(\"$ESWLabel.LiveAgentChatWindow.ChatEndAgent\"));embedded_svc.util.transaction(\"performance:EndChat\",\n{chatId:c.chatKey});embedded_svc.util.broadcastEventToClientAndLog(\"onChatEndedByAgent\",{liveAgentSessionKey:c.chatKey},this.getSidebar(a).getReleaseVersion())},onChatEndedOnDifferentTab:function(a){var b=this.getSidebar(a);a.set(\"v.chatEndedReason\",b.helper.constants.endedReasonNames.chat.VISITOR_ENDED_CHAT);!a.get(\"v.hasChatEnded\")&&a.isValid()&&(a.set(\"v.hasChatEnded\",!0),a.set(\"v.isReconnecting\",!1),a.set(\"v.isAgentTyping\",!1),this.setRichMessageInteractionState(a,!1),b.isDialogActive()&&b.popState(),\nthis.updateHeaderAndMinimizedState(a))},onChatEndedByChatbot:function(a,b){var c=embedded_svc.getSidebar(a),d=this.getChasitor(a).chasitorData,e=b&&b.schedule?b.schedule.responseDelayMilliseconds:0;a.set(\"v.chatEndedReason\",c.helper.constants.endedReasonNames.chat.CHATBOT_ENDED_CHAT);setTimeout($A.getCallback(function(){this.endChatWithReasonLabel(a,$A.get(\"$ESWLabel.LiveAgentChatWindow.ChatEndChatbot\"));embedded_svc.util.transaction(\"performance:EndChat\",{chatId:d.chatKey});embedded_svc.util.broadcastEventToClientAndLog(\"onChatEndedByChatbot\",\n{liveAgentSessionKey:d.chatKey},this.getSidebar(a).getReleaseVersion())}.bind(this)),e)},onChatEndedWithPostChat:function(a,b){var c=this.getSidebar(a);a.set(\"v.postChatData\",b);a.set(\"v.postChatURL\",b.getUrl());if(c.getConfigurationValue(\"autoOpenPostChat\"))this.removeSessionStorageItems(a),this.endChat(a),this.switchToPostchat(a);else if(\"agent\"===b.getType())this.onChatEndedByAgent(a);else if(\"client\"===b.getType())this.onChatEndedByChasitor(a);else if(b.getType()===c.helper.constants.endedReasonNames.chat.CHATBOT_ENDED_CHAT)this.onChatEndedByChatbot(a,\nvoid 0);else this.onConnectionError(a)},switchToPostchat:function(a){var b=this.getChasitor(a).chasitorData,c=this.getSidebar(a);this.getSidebar(a).replaceState(\"LiveAgent\",\"Postchat\",a.get(\"v.postChatData\"));embedded_svc.util.broadcastEventToClientAndLog(\"onPostChatPushed\",{liveAgentSessionKey:b.chatKey},c.getReleaseVersion())},onChatEndedByChasitor:function(a){var b=embedded_svc.getSidebar(a);a.set(\"v.chatEndedReason\",b.helper.constants.endedReasonNames.chat.VISITOR_ENDED_CHAT);this.endChatWithReasonLabel(a,\n$A.get(\"$ESWLabel.LiveAgentChatWindow.ChatEnd\"))},onReconnecting:function(a,b){a.set(\"v.isReconnecting\",!b);if(b)this.onChatReconnectionSuccessful(a);else this.setRichMessageInteractionState(a,!1);this.updateHeaderAndMinimizedState(a)},onReconnectingAfterChatEnded:function(a){var b=this.getChasitor(a);b.chasitorData.isChatEngaged||b.cancelChat();this.onConnectionError(a)},setRichMessageInteractionState:function(a,b){a.get(\"v.chatMessages\").forEach(function(a){var d=a.get(\"v.message\").content;\"undefined\"!==\ntypeof d&&\"string\"!==typeof d&&!d.isOptionClicked&&a.setInteractionState(b)})},onCloseSessionWarning:function(a){var b=this.getSidebar(a);b.getActiveState().get(\"v.name\")===a.get(\"v.name\")&&b.showDialog({title:$A.get(\"$ESWLabel.MessageOverlay.CloseSessionWarningTitle\"),body:$A.get(\"$ESWLabel.MessageOverlay.CloseSessionWarningBody\"),buttons:[{label:$A.get(\"$ESWLabel.MessageOverlay.CloseSessionWarningButton\"),flavor:\"default\"}],temporaryHeading:$A.get(\"$ESWLabel.LiveAgentSidebarApp.LiveChat\"),onClose:function(){this.endChatAndDestroy(a)}.bind(this),\nonRender:$A.getCallback(a.get(\"v.endChatCallback\"))})},createChatMessage:function(a,b,c,d,e,f){var h=a.get(\"v.chatMessages\");this.setMessageContentForNonChatEvent(b);this.setLastInGroupForLatestMessages(h,b,c,f);b.userId&&(this.setAvatarUrl(a,b.userId),b.avatarImgUrl=this.getAvatarUrl(a));\"string\"===typeof b.content?(b.content=this.chatFormatter.format(b.content).renderEmoji().escapeHtml().renderLinks().toString(),\"agent\"===b.type&&(this.updateAgentAvatarMap(a,b.userId,b.name),f=a.get(\"v.agentAvatarMap\").get(this.to15CharId(b.userId)),\nb.isInitialsAvatar=f.isInitialsAvatar,b.isCommunitiesContext=f.isCommunitiesContext,b.agentInitial=f.agentInitial,b.agentIconColor=f.agentIconColor,b.name=f.formattedAgentName),b.chatMessageComponentName=a.get(\"v.plaintextMessageComponentName\"),b.isChatMessageComponentCustom=b.chatMessageComponentName!==this.constants.DEFAULT_PLAINTEXT_CHAT_MESSAGE_UI_COMPONENT,this.createChatComponent(a,b,this.chatMessageComponents[b.content.type],c,d,e)):this.createRichMessage(a,b,c,d,e)},setMessageContentForNonChatEvent:function(a){\"chasitor\"!==\na.type&&\"agent\"!==a.type&&(a.content=this.getMessageForChatEvent(a))},setLastInGroupForLatestMessages:function(a,b,c,d){var e,f,h,g,k,l;f=b.type;g=b.userId?this.to15CharId(b.userId.toString()):\"\";l=typeof b.content;a.length?(a=a[a.length-1],e=a.get(\"v.message\").type,h=a.get(\"v.message\").userId?this.to15CharId(a.get(\"v.message\").userId.toString()):\"\",k=typeof a.get(\"v.message\").content,g=h!==g,c=c&&d&&d.getType()===f||!1,\"agent\"===e&&\"string\"===k?\"agent\"===f&&\"string\"===l?(a.setLastInGroup(g),b.isLastInGroup=\n!c):\"agent\"===f&&\"string\"!==l&&(a.setLastInGroup(!0),b.isLastInGroup=!1):\"agent\"===e&&\"string\"!==k?\"agent\"===f&&\"string\"===l?(a.setLastInGroup(g),b.isLastInGroup=!c):\"agent\"===f&&\"string\"!==l&&(a.setLastInGroup(g),b.isLastInGroup=!1):\"chasitor\"===e&&\"string\"===k?\"agent\"===f&&\"string\"===l?(a.setLastInGroup(!0),b.isLastInGroup=!c):\"agent\"===f&&\"string\"!==l&&(a.setLastInGroup(!0),b.isLastInGroup=!1):-1<this.systemMessageTypes.indexOf(e)&&(\"agent\"===f&&\"string\"===l?(a.setLastInGroup(!1),b.isLastInGroup=\n!c):\"agent\"===f&&\"string\"!==l&&(a.setLastInGroup(!1),b.isLastInGroup=!1))):b.isLastInGroup=\"agent\"===f&&\"string\"===l},createRichMessage:function(a,b,c,d,e){var f=a.get(\"v.chatMessages\");b.type=\"agent\";b.sendRichMessage=this.sendRichMessageWrapper(a);b.chasitor=a.get(\"v.chasitor\");this.setLastInGroupForLatestMessages(f,b,c,null);this.setAvatarUrl(a,b.content.agentId);b.avatarImgURL=this.getAvatarUrl(a);this.createChatComponent(a,b,this.chatMessageComponents[b.content.type],c,d,e)},createChatComponent:function(a,\nb,c,d,e,f){this.createChatComponentOfType(a,c,b,function(b){d?this.restoreTimestampForNewChatMessage(a,b,e,f):this.addTimestampForNewChatMessage(a,b);d||this.scrollToBottomOfMessageArea(a)}.bind(this))},createChatComponentOfType:function(a,b,c,d){$A.createComponent(b,{message:c,avatarImgURL:c.avatarImgUrl},function(b,f,h){var g;a.isValid()&&\"SUCCESS\"===f&&(g=document.getElementById(\"footerMenuContainer\"),f=a.get(\"v.chatMessages\"),g&&(g.style.display=\"none\"),void 0===c.index?f.push(b):f.splice(c.index,\n0,b),this.announceChatMessage(a,b.get(\"v.message\")),a.set(\"v.chatMessages\",f),d&&d(b));if(h)throw Error(\"Error creating Snapins chat message: \"+h);}.bind(this))},handleSend:function(a,b){var c;!a.get(\"v.isReconnecting\")&&!a.get(\"v.isTransferring\")&&(this.getChasitor(a).chasitorData.isChatEngaged&&b.length)&&(this.sendChat(a,b),a.set(\"v.chatWindowResizeClass\",\"dynamicResizeTextOneRow\"),c=a.find(\"inputFooter\"),c.helper.clearTextArea(c))},handleSendFileTransferMessage:function(a,b){b.type=\"chasitor\";\nb.avatarImgUrl=this.getAvatarUrl(a);this.createChatComponentOfType(a,\"embeddedService:liveAgentStateChatFileTransferMessage\",b,function(b){this.updateMessageOrdering(a,b);this.scrollToBottomOfMessageArea(a)}.bind(this))},updateMessageOrdering:function(a,b){var c=a.get(\"v.chatMessages\"),d=c[c.length-2].get(\"v.message\").type;if(\"fileTransferSuccess\"===d||\"fileTransferFailure\"===d)c.splice(c.length-1,1),c.splice(c.length-1,0,b),a.set(\"v.chatMessages\",c)},handleCreateFileTransferEventLine:function(a,\nb){this.updateHeaderAndMinimizedState(a);this.createChatMessage(a,{type:b.type});this.scrollToBottomOfMessageArea(a)},handleFileUploadComplete:function(a,b){var c=this.getLatestFileTransferMessage(a,b);c?\"success\"===b.result?(c.setUploadProgress(\"success\"),c.set(\"v.uploadFailed\",!1)):(c.setUploadProgress(\"fail\"),c.set(\"v.uploadFailed\",!0),c.setFileDescription($A.get(\"$ESWLabel.LiveAgentFileTransfer.TransferFailed\"))):window.requestAnimationFrame($A.getCallback(function(){a.isValid()&&this.handleFileUploadComplete(a,\nb)}.bind(this)))},getLatestFileTransferMessage:function(a,b){var c;a.get(\"v.chatMessages\").slice().reverse().forEach(function(a){var e=a.find(\"fileName\");!c&&(e&&e.get(\"v.value\")===b.fileName)&&(c=a)});return c},handleSneakPeek:function(a,b){var c=this.getChasitor(a);c.chasitorData.isChatEngaged&&c.sendSneakPeekOrTypingUpdate(b)},onChangeViewForCommunities:function(a,b){var c=this.getChasitor(a),d=this.getSidebar(a);a.isRendered()&&(d.getActiveState().get(\"v.name\")===a.get(\"v.name\")&&b!==a.get(\"v.themeLayoutTypeForCommunities\")&&\n!embedded_svc.util.isChannelMenuContext())&&(c.abortConnection(),c.stopChasitorIdleTimeout(),c.decrementActiveChatSession(),d.destroy())},onChatTransferToButtonInitiated:function(a){a.get(\"v.isQueuePositionEnabled\")&&a.set(\"v.transferRequestTime\",(new Date).getTime());a.set(\"v.showTransferText\",!1);this.onChatTransferInitiated(a)},onChatTransferToQueueOrSkills:function(a){a.set(\"v.showTransferText\",!0);this.onChatTransferInitiated(a)},onChatTransferInitiated:function(a){var b=this.getSidebar(a),c=\na.get(\"v.showTransferText\");a.set(\"v.isTransferring\",!0);this.setRichMessageInteractionState(a,!1);this.scrollToBottomOfMessageArea(a,!0);a.set(\"v.agentsInChat\",[]);this.updateTitleNotification(a);a.get(\"v.isQueuePositionEnabled\")&&!(5>Number(b.getReleaseVersion()))&&!c?\"number\"===typeof a.get(\"v.queuePosition\")&&this.setQueuePositionMinimizedContent(a):(embedded_svc.util.dispatchMinimizedEvent(a,b.helper.constants.eventNames.CHAT_TRANSFERRING_STATE,{label:$A.get(\"$ESWLabel.LiveAgentTransfer.MinimizedInProgressTransfer\")}),\nembedded_svc.util.dispatchChatHeaderEvent(a,b.helper.constants.eventNames.CHAT_TRANSFERRING_STATE,{label:$A.get(\"$ESWLabel.LiveAgentTransfer.BannerInProgressTransfer\")}))},onChatTransferSuccessful:function(a,b){var c=this.getSidebar(a),d=this.getChasitor(a).chasitorData,e;a.set(\"v.transferRequestTime\",-1);a.set(\"v.isTransferring\",!1);a.set(\"v.showTransferSuccess\",!0);embedded_svc.util.transaction(\"performance:LiveAgentTransfer\",{chatId:d.chatKey});this.createChatMessage(a,{type:\"transferred\",name:b.getName(),\ntimestamp:b.getTimestamp(),date:b.getDate()});e=b.getName()||d.details.agent.agentName;a.set(\"v.agentName\",e);a.set(\"v.agentsInChat\",[e]);this.setAvatarUrl(a,this.constants.SALESFORCE_USER_PREFIX);this.setHeaderText(a,e);this.setDefaultMinimizedAndHeaderContent(a);this.updateHeaderAndMinimizedState(a);setTimeout($A.getCallback(function(){a.isValid()&&(a.set(\"v.showTransferSuccess\",!1),this.updateHeaderAndMinimizedState(a))}.bind(this)),this.constants.TRANSFER_SUCCESS_BANNER_DURATION_MS);c.getSessionManager().get(\"CHATBOT_FOOTER_MENU\")&&\n(c.getSessionManager().remove(\"CHATBOT_FOOTER_MENU\"),this.setChatInputFooterMenuOptions(a,d));embedded_svc.util.broadcastEventToClientAndLog(\"onChatTransferSuccessful\",{liveAgentSessionKey:d.chatKey},this.getSidebar(a).getReleaseVersion())},onAgentJoinedConference:function(a,b){this.agentConferenceStateChange(a,b,!0)},onAgentLeftConference:function(a,b){this.agentConferenceStateChange(a,b,!1)},agentConferenceStateChange:function(a,b,c){var d=this.getSidebar(a),e=!a.get(\"v.isChatConference\")&&c,f=\n1===a.get(\"v.agentsInChat\").length-1&&!c;b={agentName:b?b.name:\"\",isJoining:c};this.updateAgentsInChat(a,b.agentName,c);e?a.set(\"v.chatConferenceHeaderAnnouncementSubText\",$A.util.format($A.get(\"$ESWLabel.LiveAgentGroupChat.ExtendedHeaderGreeting\"),a.get(\"v.agentsInChat\").length)):f&&a.set(\"v.chatConferenceHeaderAnnouncementSubText\",\"\");if(e||f)a.set(\"v.isChatConference\",c),f&&(embedded_svc.util.dispatchMinimizedEvent(a,d.helper.constants.eventNames.CHAT_CONFERENCE_STATE,{label:$A.get(\"$ESWLabel.LiveAgentGroupChat.MinimizedStateMessage\"),\nagentsInChat:a.get(\"v.agentsInChat\"),isJoining:b.isJoining,agentName:b.agentName}),embedded_svc.util.dispatchChatHeaderEvent(a,d.helper.constants.eventNames.CHAT_CONFERENCE_STATE,{label:$A.get(\"$ESWLabel.LiveAgentGroupChat.HeaderTitle\"),subLabel:this.determineHeaderSubText(a)}),a.set(\"v.agentName\",a.get(\"v.agentsInChat\")[0]),this.setHeaderText(a,a.get(\"v.agentsInChat\")[0])),embedded_svc.util.broadcastEventToClientAndLog(c?\"onChatConferenceInitiated\":\"onChatConferenceEnded\",{liveAgentSessionKey:this.getChasitor(a).chasitorData.chatKey},\nd.getReleaseVersion());this.updateHeaderAndMinimizedState(a,b);this.setHeaderText(a,a.get(\"v.agentsInChat\")&&1<a.get(\"v.agentsInChat\").length?$A.get(\"$ESWLabel.LiveAgentGroupChat.HeaderTitle\"):a.get(\"v.agentName\"));this.createChatMessage(a,{type:c?\"agentJoinedConference\":\"agentLeftConference\",name:b.agentName});embedded_svc.util.broadcastEventToClientAndLog(c?\"onAgentJoinedConference\":\"onAgentLeftConference\",{liveAgentSessionKey:this.getChasitor(a).chasitorData.chatKey,numberOfAgentsInConference:a.get(\"v.agentsInChat\").length},\nd.getReleaseVersion())},onChatReconnectionSuccessful:function(a){var b=this.getChasitor(a).chasitorData;a.set(\"v.isReconnecting\",!1);a.set(\"v.showReconnectSuccess\",!0);b=b.details.agent.agentName;a.set(\"v.agentName\",b);this.setHeaderText(a,b);this.setDefaultMinimizedAndHeaderContent(a);this.updateHeaderAndMinimizedState(a);setTimeout($A.getCallback(function(){a.isValid()&&(a.set(\"v.showReconnectSuccess\",!1),this.updateHeaderAndMinimizedState(a))}.bind(this)),this.constants.TRANSFER_SUCCESS_BANNER_DURATION_MS);\nthis.setRichMessageInteractionState(a,!0)},onQueueUpdate:function(a,b){var c=this.getChasitor(a).chasitorData,d=a.find(\"queuePosition\");a.set(\"v.queuePosition\",b);d&&(void 0===d.get(\"v.lastQueueUpdateAnnouncementTime\")&&d.set(\"v.lastQueueUpdateAnnouncementTime\",a.get(\"v.transferRequestTime\")),d.updateQueuePositionAndAnnounceIfNecessary(b));this.setQueuePositionMinimizedContent(a);this.scrollToBottomOfMessageArea(a);this.updateHeaderAndMinimizedState(a);embedded_svc.util.broadcastEventToClientAndLog(\"onQueueUpdate\",\n{liveAgentSessionKey:c.chatKey,queuePosition:c.queuePosition},this.getSidebar(a).getReleaseVersion())},setQueuePositionMinimizedContent:function(a){var b=this.getSidebar(a),c=a.find(\"queuePosition\");c&&(void 0===c.get(\"v.queuePosition\")?embedded_svc.util.dispatchEvent(a,b.helper.constants.eventNames.CHAT_TRANSFERRING_STATE,{label:$A.get(\"$ESWLabel.LiveAgentTransfer.MinimizedInProgressTransfer\")}):c.setQueuePositionMinimizedState())},getMessageForChatEvent:function(a){switch(a.type){case \"ended\":return a.name;\ncase \"transferred\":return $A.util.format($A.get(\"$ESWLabel.LiveAgentTransfer.MessageAreaTransferred\"),a.name);case \"fileTransferCanceled\":return $A.get(\"$ESWLabel.LiveAgentFileTransfer.FileTransferCanceled\");case \"fileTransferSuccess\":return $A.get(\"$ESWLabel.LiveAgentFileTransfer.FileTransferSuccess\");case \"fileTransferFailure\":return $A.get(\"$ESWLabel.LiveAgentFileTransfer.FileTransferFailure\");case \"fileTransferRequested\":return $A.get(\"$ESWLabel.LiveAgentFileTransfer.FileTransferRequested\");case \"agentJoinedConference\":return $A.util.format($A.get(\"$ESWLabel.LiveAgentGroupChat.AgentJoinedChatSystemMessage\"),\n(a.name||\"\").split(\" \")[0]);case \"agentLeftConference\":return $A.util.format($A.get(\"$ESWLabel.LiveAgentGroupChat.AgentLeftChatSystemMessage\"),(a.name||\"\").split(\" \")[0]);default:return embedded_svc.util.error(\"Invalid message type \"+a.type+\".\"),\"\"}},addTimestampForNewChatMessage:function(a,b){var c=b.get(\"v.message\"),d,e;b.get(\"v\").hasAttribute(\"isTimestampViewable\")&&!1===b.get(\"v.isTimestampViewable\")||(this.scheduledTimestampTimeoutId&&clearTimeout(this.scheduledTimestampTimeoutId),d=new Date(c.date),\nthis.mostRecentTimeStamp&&(e=c.date-this.mostRecentTimeStamp.getTime()),e>this.constants.TIMESTAMP_DELAY_MS?(this.mostRecentTimeStamp=d,this.scheduleDisplayMessageTimestamp(a,b,d,this.constants.TIMESTAMP_DELAY_MS)):this.scheduledTimestampTimeoutId=this.scheduleDisplayMessageTimestamp(a,b,d,this.constants.TIMESTAMP_DELAY_MS))},scheduleDisplayMessageTimestamp:function(a,b,c,d){return setTimeout(embedded_svc.util.getSafeCallback(this.displayMessageTimestamp.bind(this,a,b,c)),d)},displayMessageTimestamp:function(a,\nb,c,d){var e,f,h=$A.get(\"$Locale.timeFormat\").replace(\":ss\",\"\");a.isValid()&&(e=a.get(\"v.chatMessages\"),f=b.get(\"v.message\"),this.mostRecentTimeStamp=c,c=$A.localizationService.formatDateTime(c,h),b.setFormattedTimestamp(c),e.forEach(function(b){b.get(\"v.message\")===f&&!d&&this.scrollToBottomOfMessageArea(a)}.bind(this)))},initializeChatSessionStartTime:function(a){var b=$A.get(\"$Locale.timeFormat\").replace(\":ss\",\"\"),c=new Date(this.getChasitor(a).chasitorData.acceptTime);a.set(\"v.chatSessionStartTime\",\n$A.localizationService.formatDateTime(c,b));this.mostRecentTimeStamp=c},restoreTimestampForNewChatMessage:function(a,b,c,d){var e=b.get(\"v.message\"),e=new Date(e.date),f=e.getTime()-this.mostRecentTimeStamp.getTime();b.get(\"v\").hasAttribute(\"isTimestampViewable\")&&!1===b.get(\"v.isTimestampViewable\")||(c||-1===d?(c=Date.now()-e.getTime(),f>this.constants.TIMESTAMP_DELAY_MS||c>this.constants.TIMESTAMP_DELAY_MS?this.displayMessageTimestamp(a,b,e,!0):this.scheduledTimestampTimeoutId=this.scheduleDisplayMessageTimestamp(a,\nb,e,this.constants.TIMESTAMP_DELAY_MS)):(c=new Date(d),c=c.getTime()-e.getTime(),(f>this.constants.TIMESTAMP_DELAY_MS||c>this.constants.TIMESTAMP_DELAY_MS)&&this.displayMessageTimestamp(a,b,e,!0)))},scrollToBottomOfMessageArea:function(a,b){var c=this.getMessageAreaElement(a);c&&(b||a.get(\"v.scrollEnabled\")&&!a.get(\"v.scrolledUp\")||this.isScrolledToBottomOfMessageArea(a)&&a.get(\"v.scrollEnabled\")&&!this.getSidebar(a).get(\"v.isMinimized\"))&&embedded_svc.util.waitForFrame(a,function(){c.scrollTop=c.scrollHeight-\nc.offsetHeight})},isScrolledToBottomOfMessageArea:function(a){a=this.getMessageAreaElement(a);return 2>Math.abs(a.scrollHeight-a.offsetHeight-a.scrollTop)},endChatWithReasonLabel:function(a,b){var c=this.getSidebar(a);!a.get(\"v.hasChatEnded\")&&a.isValid()&&(a.set(\"v.hasChatEnded\",!0),a.set(\"v.isReconnecting\",!1),a.set(\"v.isAgentTyping\",!1),a.set(\"v.isTransferring\",!1),this.createChatMessage(a,{type:\"ended\",name:b}),a.set(\"v.endChatAssistiveText\",b),this.setRichMessageInteractionState(a,!1),c.isDialogActive()&&\nc.popState(),this.updateHeaderAndMinimizedState(a),this.removeSessionStorageItems(a),this.endChat(a))},setHeaderText:function(a,b){var c=this.getSidebar(a).getHeader();c&&\"embeddedServiceChatHeader\"===c.getName()&&c.setText(b)},setHeaderAnnouncementSubText:function(a,b){var c=this.getSidebar(a).getHeader();c&&\"embeddedServiceChatHeader\"===c.getName()&&c.setAnnouncementSubText(b)},determineHeaderSubText:function(a){return a.get(\"v.isChatConference\")?$A.util.format($A.get(\"$ESWLabel.LiveAgentGroupChat.ExtendedHeaderGreeting\"),\na.get(\"v.agentsInChat\").length):$A.get(\"$ESWLabel.LiveAgentChatWindow.ChatStateHeaderGreeting\")},onEndChatConfirmed:function(a){this.getSidebar(a).popState();this.populateSurveyDevNameIfExists(a);embedded_svc.util.waitForFrame(a,function(){this.onChatEndedByChasitor(a)}.bind(this));embedded_svc.util.broadcastEventToClientAndLog(\"onChatEndedByChasitor\",{liveAgentSessionKey:this.getChasitor(a).chasitorData.chatKey},this.getSidebar(a).getReleaseVersion())},updateHeaderAndMinimizedState:function(a,b){var c=\nthis.getSidebar(a),d=a.get(\"v.timeoutSecondsRemaining\"),e=(a.get(\"v.agentName\")||\"\").split(\" \")[0],f=a.get(\"v.isChattingWithAgent\")?c.helper.constants.agentTypeNames.AGENT:c.helper.constants.agentTypeNames.CHATBOT;this.updateTitleNotification(a);if(a.get(\"v.hasChatEnded\")){if($A.util.isEmpty(a.get(\"v.chatEndedReason\")))throw Error(\"Chat ended reason cannot be undefined. Cannot dispatch chatEndedState minimized event.\");embedded_svc.util.dispatchEvent(a,c.helper.constants.eventNames.CHAT_ENDED_STATE,\n{label:$A.get(\"$ESWLabel.LiveAgentChatWindow.ChatEnd\"),reason:a.get(\"v.chatEndedReason\")})}else a.get(\"v.isReconnecting\")?(embedded_svc.util.dispatchMinimizedEvent(a,c.helper.constants.eventNames.RECONNECTING_STATE,{label:$A.get(\"$ESWLabel.LiveAgentChatWindow.ReconnectingMinimizedMessage\")}),embedded_svc.util.dispatchChatHeaderEvent(a,c.helper.constants.eventNames.RECONNECTING_STATE,{label:$A.get(\"$ESWLabel.LiveAgentChatWindow.ReconnectingChasitorIssue\")})):-1<d?(embedded_svc.util.dispatchMinimizedEvent(a,\nc.helper.constants.eventNames.CHAT_TIMEOUT_UPDATE,{label:$A.get(\"$ESWLabel.LiveAgentChatWindow.IdleTimeoutMinimizedWarning\"),timeoutSecondsRemaining:d}),embedded_svc.util.dispatchChatHeaderEvent(a,c.helper.constants.eventNames.CHAT_TIMEOUT_UPDATE,{label:$A.get(\"$ESWLabel.LiveAgentChatWindow.IdleTimeoutWarningQuestion\")+$A.get(\"$ESWLabel.LiveAgentChatWindow.IdleTimeoutWarningRequest\"),timeoutSecondsRemaining:d})):a.get(\"v.showTransferSuccess\")?embedded_svc.util.dispatchChatHeaderEvent(a,c.helper.constants.eventNames.CHAT_STATE,\n{label:this.getAgentName(a),subLabel:$A.util.format($A.get(\"$ESWLabel.LiveAgentTransfer.BannerTransferred\"),e),agentName:this.getAgentName(a),agentType:f}):a.get(\"v.showReconnectSuccess\")?embedded_svc.util.dispatchChatHeaderEvent(a,c.helper.constants.eventNames.CHAT_STATE,{label:this.getAgentName(a),subLabel:$A.util.format($A.get(\"$ESWLabel.LiveAgentTransfer.BannerReconnected\"),e),agentName:this.getAgentName(a),agentType:f}):a.get(\"v.isTransferring\")?a.get(\"v.isQueuePositionEnabled\")&&!(5>Number(c.getReleaseVersion()))?\n\"number\"===typeof a.get(\"v.queuePosition\")&&this.setQueuePositionMinimizedContent(a):embedded_svc.util.dispatchEvent(a,c.helper.constants.eventNames.CHAT_TRANSFERRING_STATE,{label:$A.get(\"$ESWLabel.LiveAgentTransfer.MinimizedInProgressTransfer\")}):a.get(\"v.isChatConference\")?a.get(\"v.isUnseenMessageBannerDisplayed\")&&0<a.get(\"v.unseenMessageCount\")?this.displayUnreadMinimizedMessage(a):(b?embedded_svc.util.dispatchMinimizedEvent(a,c.helper.constants.eventNames.CHAT_CONFERENCE_STATE,{label:$A.get(\"$ESWLabel.LiveAgentGroupChat.MinimizedStateMessage\"),\nagentsInChat:a.get(\"v.agentsInChat\"),isJoining:b.isJoining,agentName:b.agentName}):embedded_svc.util.dispatchMinimizedEvent(a,c.helper.constants.eventNames.CHAT_CONFERENCE_STATE,{label:$A.get(\"$ESWLabel.LiveAgentGroupChat.MinimizedStateMessage\"),agentsInChat:a.get(\"v.agentsInChat\")}),embedded_svc.util.dispatchChatHeaderEvent(a,c.helper.constants.eventNames.CHAT_CONFERENCE_STATE,{label:$A.get(\"$ESWLabel.LiveAgentGroupChat.HeaderTitle\"),subLabel:a.get(\"v.chatConferenceHeaderAnnouncementSubText\")})):\n0<a.get(\"v.unseenMessageCount\")?this.displayUnreadMinimizedMessage(a):this.setDefaultMinimizedAndHeaderContent(a)},removeSessionStorageItems:function(a){this.getSidebar(a).getSessionManager().remove(\"CHASITOR_SERIALIZED_KEY\");this.getSidebar(a).getSessionManager().remove(\"CHATBOT_FOOTER_MENU\");this.getSidebar(a).getSessionManager().remove(\"LA_ESW_SHOW_QUEUE_POSITION\");this.getSidebar(a).getSessionManager().remove(\"SCROLL_ENABLED\")},updateMessageAreaScrollHandler:function(a){var b=a.get(\"v.messageAreaScrollHandler\"),\nc=a.find(\"messageArea\").getElement();b&&c.removeEventListener(\"scroll\",b,!1);b=$A.getCallback(function(){var b;a.isValid()&&((b=a.get(\"v.scrollDebounceTimeout\"))&&clearTimeout(b),a.isValid()&&(!this.shouldUnseenMessageCounterBeDisplayed(a)&&0<a.get(\"v.chatMessages\").length)&&this.clearNewMessageNotifications(a),a.set(\"v.scrollDebounceTimeout\",setTimeout($A.getCallback(function(){var b;a.isValid()&&(b=a.find(\"messageArea\"))&&b.isRendered()&&this.getSidebar(a).getSessionManager().set(\"LA_ESW_CHAT_SCROLL_POSITION\",\nMath.round(b.getElement().scrollTop))}.bind(this)),250)))}.bind(this));c.addEventListener(\"scroll\",b,!1);a.set(\"v.messageAreaScrollHandler\",b)},shouldUnseenMessageCounterBeDisplayed:function(a){var b=this.getSidebar(a),c=this.getMessageAreaElement(a),d,e=Math.abs(c.scrollHeight-c.offsetHeight-c.scrollTop);if(c){if(d=b.get(\"v.isMinimized\")||60<e)a.set(\"v.isUnseenMessageBannerDisplayed\",d);else if(b=a.getElement().querySelector(\"embeddedservice-chat-unseen-message-notification\"))b.shadowRoot.querySelector(\".unseenMessageNotification\").classList.add(\"hideMessageCount\"),\nwindow.matchMedia(\"(prefers-reduced-motion: reduce)\").matches&&a.set(\"v.isUnseenMessageBannerDisplayed\",d),b.shadowRoot.querySelector(\".unseenMessageNotification\").addEventListener(\"animationend\",function(){a.set(\"v.isUnseenMessageBannerDisplayed\",d)});return d}a.set(\"v.isUnseenMessageBannerDisplayed\",!1);return!1},displayUnreadMinimizedMessage:function(a){var b=this.getSidebar(a),c=a.get(\"v.isChattingWithAgent\")?b.helper.constants.agentTypeNames.AGENT:b.helper.constants.agentTypeNames.CHATBOT;embedded_svc.util.dispatchEvent(a,\nb.helper.constants.eventNames.CHAT_UNREAD_MESSAGE,{label:this.getMinimizedNotificationMessage(a.get(\"v.unseenMessageCount\")),unreadMessageCount:a.get(\"v.unseenMessageCount\"),agentType:c,labelAssistiveText:this.getSidebar(a).getConfigurationValue(\"defaultAssistiveText\")})},getAvatarUrl:function(a){return a.get(\"v.avatarImgURL\")},setAvatarUrl:function(a,b){var c=this.getSidebar(a),d=c.getConfigurationValue(\"chatbotAvatarImgURL\"),c=c.getConfigurationValue(\"avatarImgURL\")||c.getConfigurationValue(\"embeddedServiceConfig.embeddedServiceLiveAgent.avatarImg\"),\ne=b.substr(0,3)===this.constants.SALESFORCE_USER_PREFIX;a.set(\"v.isChattingWithAgent\",e);!e&&!a.get(\"v.chatBotHasBeenInChat\")&&a.set(\"v.chatBotHasBeenInChat\",!0);d&&!e?a.set(\"v.avatarImgURL\",d):e&&a.set(\"v.avatarImgURL\",c)},getAgentNameFromChatMessage:function(a,b){return a.name.length?a.name:b.details.agent.agentName},getAgentName:function(a){return a.get(\"v.agentName\")||$A.get(\"$ESWLabel.LiveAgentChatWindow.ChatWindowAgent\")},updateAgentsInChat:function(a,b,c){var d=a.get(\"v.agentsInChat\"),e=d.indexOf(b);\nc?d.push(b):d.splice(e,1);a.set(\"v.agentsInChat\",d)},updateAgentAvatarMap:function(a,b,c){b=this.to15CharId(b);var d=a.get(\"v.agentAvatarMap\")||new Map,e=d.size,f=d.get(b);d.has(b)?f.agentName!==c&&(this.updateAgentsInChat(a,f.agentName,!1),this.updateAgentsInChat(a,c,!0),f.formattedAgentName=this.generateFormattedAgentName(a,c),f.agentName=c,d.set(b,f),a.set(\"v.agentAvatarMap\",d)):(d.set(b,this.generateAgentAvatarData(a,c,e)),a.set(\"v.agentAvatarMap\",d))},generateAgentAvatarData:function(a,b,c){var d=\n{},e=1===c&&a.get(\"v.chatBotHasBeenInChat\");(0===c||e)&&this.getAvatarUrl(a)?(d.isInitialsAvatar=!1,d.agentIconColor=-1,d.avatarImgURL=this.getAvatarUrl(a)):(d.isInitialsAvatar=!0,d.agentIconColor=c%7);d.formattedAgentName=this.generateFormattedAgentName(a,b);d.agentName=b;d.agentInitial=b.charAt(0).toUpperCase();d.isCommunitiesContext=!!$A.get(\"$Site\");return d},generateFormattedAgentName:function(a,b){var c=a.get(\"v.agentAvatarMap\")||new Map,d=b,e=1;c.forEach(function(a,c){a.agentName===b&&(e+=\n1)});1<e&&(d=d+\" (\"+e+\")\");return d},setMessageData:function(a,b){var c=a.get(\"v.message\");Object.keys(b).forEach(function(a){c[a]=b[a]});a.set(\"v.message\",c)},setDefaultMinimizedAndHeaderContent:function(a){var b=this.getSidebar(a),c=a.get(\"v.isChattingWithAgent\")?b.helper.constants.agentTypeNames.AGENT:b.helper.constants.agentTypeNames.CHATBOT,d={label:this.getAgentName(a),agentName:this.getAgentName(a),agentType:c},c={label:this.getAgentName(a),subLabel:$A.get(\"$ESWLabel.LiveAgentChatWindow.ChatStateHeaderGreeting\"),\nagentName:this.getAgentName(a),agentType:c};embedded_svc.util.dispatchMinimizedEvent(a,b.helper.constants.eventNames.CHAT_STATE,d);embedded_svc.util.dispatchChatHeaderEvent(a,b.helper.constants.eventNames.CHAT_STATE,c)},getChasitorInputElement:function(a){if(a=a.find(\"inputFooter\").find(\"chasitorText\"))return a.getElement().querySelector(\"textarea\")},to15CharId:function(a){return a.substring(0,15)},onIdleTimeoutWarningStart:function(a,b){embedded_svc.util.broadcastEventToClientAndLog(\"onIdleTimeoutWarningStart\",\n{liveAgentSessionKey:this.getChasitor(a).chasitorData.chatKey},this.getSidebar(a).getReleaseVersion());this.onIdleTimeoutWarningUpdate(a,b)},onIdleTimeoutWarningUpdate:function(a,b){a.set(\"v.timeoutSecondsRemaining\",b);this.updateHeaderAndMinimizedState(a)},onIdleTimeoutClear:function(a){var b=this.getSidebar(a);embedded_svc.util.broadcastEventToClientAndLog(\"onIdleTimeoutClear\",{liveAgentSessionKey:this.getChasitor(a).chasitorData.chatKey},this.getSidebar(a).getReleaseVersion());embedded_svc.util.dispatchEvent(a,\nb.helper.constants.eventNames.CHAT_TIMEOUT_CLEAR,{label:this.getAgentName(a)});a.set(\"v.timeoutSecondsRemaining\",-1);this.clearNotifications(a)},onIdleTimeoutOccurred:function(a){var b=embedded_svc.getSidebar(a),c=this.getChasitor(a).chasitorData;a.set(\"v.chatEndedReason\",b.helper.constants.endedReasonNames.chat.VISITOR_TIMEOUT);this.endChatWithReasonLabel(a,$A.get(\"$ESWLabel.LiveAgentChatWindow.IdleTimeoutEndChatMessage\"));embedded_svc.util.broadcastEventToClientAndLog(\"onIdleTimeoutOccurred\",{liveAgentSessionKey:c.chatKey},\nthis.getSidebar(a).getReleaseVersion())},getMessageAreaElement:function(a){if(a=a.find(\"messageArea\"))return a.getElement()},clearNewMessageNotifications:function(a){var b=a.getElement().querySelector(\"embeddedservice-chat-unseen-message-notification\"),c;if(b&&(c=b.shadowRoot.querySelector(\".unseenMessageNotification \\x3e .unseenMessageBubble\")))window.matchMedia(\"(prefers-reduced-motion: reduce)\").matches&&a.set(\"v.unseenMessageCount\",0),b.shadowRoot.querySelector(\".unseenMessageNotification\").addEventListener(\"animationend\",\nfunction(){a.set(\"v.unseenMessageCount\",0)});this.clearNotifications(a);this.getSidebar(a).getSessionManager().remove(\"LA_ESW_UNSEEN_MESSAGES\");this.updateHeaderAndMinimizedState(a)},setFocusOnChatInput:function(a,b){var c=this.isMobileDevice()?\".embeddedServiceLiveAgentStateChatInputFooter\":\"textarea.chasitorText\";embedded_svc.util.focusAfterRender(a,c,b)},isMobileDevice:function(){return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?!0:!1},handleScroll:function(a){var b=this.getMessageAreaElement(a);\na.set(\"v.scrollEnabled\",!0);this.getSidebar(a).getSessionManager().set(\"SCROLL_ENABLED\",!0);0<Math.abs(b.scrollHeight-b.offsetHeight-b.scrollTop)?a.set(\"v.scrolledUp\",!0):a.set(\"v.scrolledUp\",!1)},populateSurveyDevNameIfExists:function(a){var b=this.getSidebar(a).getConfigurationValueFromList(\"embeddedServiceConfig.embeddedServiceFlows\",{flowType:\"LA_Survey\"});$A.util.isEmpty(b)||a.set(\"v.surveyDevName\",b.flow)},announceChatMessage:function(a,b){var c,d,e;if(b&&(c=b.content))\"string\"!==typeof c&&\nc.items?(d=$A.get(\"$Label.LiveAgentChatWindow.RichMessageAssistiveText\").replace(/\\{0\\}/,c.items.length),e=\"chat_onAgentRichMessage\"):\"string\"===typeof c&&(d=this.unescapeHTMLText(c),e=\"chat_onAgentMessage\"),\"\"!==d&&embedded_svc.util.getAriaLiveAnnouncer(a).announceMessage(d,{announceInIntervalsEnabled:!1,minTimeBetweenAnnouncements:0,forceAnnouncement:!0,context:e})},unescapeHTMLText:function(a){try{return(new DOMParser).parseFromString(a,\"text/html\").documentElement.textContent}catch(b){console.warn(\"Something went wrong while parsing accessible text\",\nb)}}},renderer:{afterRender:function(a,b){a.superAfterRender();b.updateMessageAreaScrollHandler(a);a.getElement()&&a.isValid()&&a.getElement().addEventListener(\"embeddedserviceendchat\",a.get(\"v.endChatCallback\"))},unrender:function(a){a.superUnrender();a.getElement()&&a.isValid()&&a.getElement().removeEventListener(\"embeddedserviceendchat\",a.get(\"v.endChatCallback\"))}}}});","uuid":null}"createdN €Ð|àwB"expiresN €Â«}àwB"valueEncodedF{"sizeIÐ•"expiresN €Â«}àwB{